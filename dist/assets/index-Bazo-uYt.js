import{c}from"./supabase-BtUICepX.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();let o=null;function d(){return o||(o=c("https://eyhjurkjgpxrkycentux.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV5aGp1cmtqZ3B4cmt5Y2VudHV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NTQ2NzMsImV4cCI6MjA4NjAzMDY3M30.V2E4NjmsMwD0NkOKsQOKkOtpLlWWiiGxXGms-kvU-9w",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),o)}class u{constructor(e){this.supabase=e,this.currentGame=null,this.loveRuntimeLoaded=!1,this.gameContainer=null,this.canvas=null}async loadGame(e,t){this.createGameContainer(),this.showLoadingScreen(t),this.setupBackButton(),await this.loadGameInFrame(e,t)}createGameContainer(){this.gameContainer&&this.gameContainer.remove(),this.gameContainer=document.createElement("div"),this.gameContainer.id="game-container",this.gameContainer.style.cssText=`
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    `,document.body.appendChild(this.gameContainer)}showLoadingScreen(e){this.gameContainer.innerHTML=`
      <div style="text-align: center; color: white; font-family: 'Press Start 2P', monospace;">
        <div style="font-size: 2rem; margin-bottom: 20px;">ðŸŽ®</div>
        <div style="font-size: 0.8rem; color: #00ffe7; margin-bottom: 30px;">LOADING ${e.toUpperCase()}</div>
        <div style="width: 300px; height: 12px; background: #151525; border-radius: 20px; overflow: hidden; border: 1px solid #252540;">
          <div id="load-progress" style="width: 0%; height: 100%; background: linear-gradient(90deg, #00ffe7, #00b3ff); border-radius: 20px; transition: width 0.3s;"></div>
        </div>
        <div id="load-percent" style="font-size: 0.6rem; color: #00ffe7; margin-top: 15px;">0%</div>
      </div>
    `}setupBackButton(){const e=document.createElement("div");e.id="game-back-btn",e.innerHTML="âœ•",e.style.cssText=`
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 99999;
      background: rgba(0,0,0,0.6);
      border: 2px solid rgba(0,255,231,0.5);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #00ffe7;
      font-size: 20px;
      font-weight: bold;
      backdrop-filter: blur(4px);
      opacity: 1;
      transition: opacity 0.3s, transform 0.1s;
    `,e.addEventListener("click",()=>this.closeGame()),e.addEventListener("touchstart",n=>{n.stopPropagation(),e.style.transform="scale(0.9)"}),e.addEventListener("touchend",()=>{e.style.transform="scale(1)"}),setTimeout(()=>{e.style.opacity="0.3"},4e3);const t=()=>{e.style.opacity="1",clearTimeout(e.fadeTimer),e.fadeTimer=setTimeout(()=>{e.style.opacity="0.3"},4e3)};document.addEventListener("touchstart",t),document.addEventListener("mousemove",t),this.gameContainer.appendChild(e)}async loadGameInFrame(e,t){const n=document.createElement("iframe");n.id="game-iframe",n.style.cssText=`
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
      background: #000;
    `;const s={snake:"./snake/index.html","escape-protocol":"./escape-protocol/index.html"};n.src=s[e]||s.snake,n.addEventListener("load",()=>{console.log(`Game ${t} loaded successfully`),this.currentGame={gameId:e,gameName:t,iframe:n}}),this.gameContainer.appendChild(n),await this.requestFullscreen(),this.supabase&&await this.trackGameSession(e,"start")}async requestFullscreen(){if(!(document.fullscreenElement||window.navigator.standalone))try{const e=document.documentElement;e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen&&await e.webkitRequestFullscreen()}catch(e){console.log("Fullscreen not available:",e)}}async closeGame(){if(this.currentGame){if(this.supabase&&await this.trackGameSession(this.currentGame.gameId,"end"),document.fullscreenElement)try{await document.exitFullscreen()}catch(e){console.log("Failed to exit fullscreen:",e)}this.gameContainer&&(this.gameContainer.style.opacity="0",this.gameContainer.style.transition="opacity 0.3s",setTimeout(()=>{this.gameContainer?.remove(),this.gameContainer=null},300)),this.currentGame=null}}async trackGameSession(e,t){try{const{data:{user:n}}=await this.supabase.auth.getUser();if(!n)return;await this.supabase.from("game_sessions").insert({user_id:n.id,game_id:e,event_type:t,timestamp:new Date().toISOString()})}catch(n){console.error("Failed to track game session:",n)}}}class m{constructor(){this.deferredPrompt=null,this.isIOS=this.detectIOS(),this.isAndroid=this.detectAndroid(),this.isStandalone=this.detectStandalone(),this.init()}detectIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}detectAndroid(){return/Android/.test(navigator.userAgent)}detectStandalone(){return window.navigator.standalone===!0||window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: fullscreen)").matches}init(){window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),this.deferredPrompt=t,this.updateInstallUI()}),this.isStandalone||this.showPWASection();const e=document.getElementById("pwa-action-btn");e&&e.addEventListener("click",()=>this.handleInstallClick())}showPWASection(){const e=document.getElementById("pwa-section"),t=document.getElementById("pwa-steps"),n=document.getElementById("pwa-action-btn"),s=document.getElementById("pwa-desc");e&&(this.isIOS?(s.textContent="iOS requires installing the app for fullscreen gaming!",t.innerHTML='1. Tap the <b>Share button</b> âŽ‹ (bottom of Safari)<br>2. Scroll down and tap <b>"Add to Home Screen"</b><br>3. Tap <b>"Add"</b><br>4. Open GameHub from your home screen',n.textContent="I UNDERSTAND"):this.isAndroid?(s.textContent="Install for fullscreen gaming with no browser bars!",t.innerHTML='Tap <b>INSTALL NOW</b> below, or use browser menu â†’ <b>"Install app"</b>',n.textContent="INSTALL NOW"):(s.textContent="Install the app for the best experience!",t.innerHTML='Click the install icon in your browser address bar, or use menu â†’ <b>"Install app"</b>',n.textContent="INSTALL"),e.style.display="block")}updateInstallUI(){const e=document.getElementById("pwa-action-btn");e&&!this.isIOS&&(e.textContent="INSTALL NOW")}async handleInstallClick(){if(this.deferredPrompt&&!this.isIOS){this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;console.log(`User ${e} the install prompt`),this.deferredPrompt=null}else this.isIOS&&window.scrollTo({top:0,behavior:"smooth"})}}class l{constructor(){this.supabase=null,this.gameLoader=null,this.pwaInstaller=null,this.currentUser=null}async init(){this.supabase=d(),this.gameLoader=new u(this.supabase),this.pwaInstaller=new m,this.setupEventListeners(),await this.loadUserSession(),this.updateUI()}async loadUserSession(){const{data:{session:e}}=await this.supabase.auth.getSession();this.currentUser=e?.user||null,this.currentUser&&console.log("User logged in:",this.currentUser.email)}setupEventListeners(){document.querySelectorAll(".game-card[data-game-id]").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const s=t.dataset.gameId,a=t.dataset.gameName;this.loadGame(s,a)})});const e=document.getElementById("searchInput");e&&e.addEventListener("input",t=>this.handleSearch(t.target.value)),document.querySelectorAll(".category-tag").forEach(t=>{t.addEventListener("click",()=>this.handleCategoryFilter(t))})}async loadGame(e,t){try{this.currentUser&&await this.trackGameLaunch(e),await this.gameLoader.loadGame(e,t)}catch(n){console.error("Failed to load game:",n),alert("Failed to load game. Please try again.")}}async trackGameLaunch(e){try{await this.supabase.from("game_launches").insert({user_id:this.currentUser.id,game_id:e,launched_at:new Date().toISOString()})}catch(t){console.error("Failed to track game launch:",t)}}handleSearch(e){const t=e.toLowerCase();document.querySelectorAll(".game-card").forEach(n=>{const s=n.querySelector(".game-title")?.textContent.toLowerCase()||"",a=n.querySelector(".game-category")?.textContent.toLowerCase()||"",r=s.includes(t)||a.includes(t);n.style.display=r?"flex":"none"})}handleCategoryFilter(e){document.querySelectorAll(".category-tag").forEach(n=>n.classList.remove("active")),e.classList.add("active");const t=e.dataset.category;document.querySelectorAll(".game-card").forEach(n=>{const s=n.dataset.category||"",a=t==="all"||s.includes(t);n.style.display=a?"flex":"none"})}updateUI(){const e=document.querySelectorAll(".game-card[data-game-id]").length,t=document.getElementById("gameCount");t&&(t.textContent=e)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{new l().init()}):new l().init();
